Как авторизоваться в системе Диадок
===================================

Для работы с системой Диадок необходимо:

* :doc:`загрузить внешнюю компоненту <HowTo_load_dll>`
* создать соединение с сервером Диадок
* создать контекст работы с организацией


.. rubric:: Как создать соединение и авторизоваться

Для вызовов методов сервера Диадок необходимо авторизоваться  и получить объект :doc:`соединения <../ComObjects/Connection>`. Соединение следует создавать на каждый сеанс работы.
Явно освобождать ресурсы после окончания работы с этим объектом не нужно.

.. code-block:: c#

    //Получение списка сертификатов
    Certificates = DiadocApi.GetPersonalCertificates();

    //Создание соединения
    ОтпечатокСертификата = Certificates.GetItem(0).Thumbprint;
    DiadocConnection = DiadocApi.CreateConnectionByCertificate(ОтпечатокСертификата);


.. rubric:: Как создать контекст работы с организацией

Все действия с документами: отправка, получение, подписание и т.д. - выполняются в контексте организации, к которой пользователь имеет права доступа в системе Диадок.
Для работы с контекстом организации предназначен объект :doc:`Organization <../ComObjects/Organization>`.
Получить его можно одним из двух способов:

.. rubric:: Получение контекста организации по идентификатору

.. code-block:: c#

    BoxId = "8fd0af8abe934c7091b5ccd476ef1cb5@diadoc.ru";
    Organization = DiadocConnection.GetOrganizationById(BoxId);

.. rubric:: Получение всех доступных пользователю организаций

.. code-block:: c#

    // Получение списка организаций
    OrganizationList = DiadocConnection.GetOrganizationList();
    Ц = 0;
    Пока Ц < OrganizationList.Count() Цикл
        // Получение конкретной организации
        Organization = OrganizationList.GetItem(ц);
        Сообщить(Organization.Name);
        Ц = Ц + 1;
    КонецЦикла;
